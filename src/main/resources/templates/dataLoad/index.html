<!DOCTYPE HTML>
<!--suppress ALL-->
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>模板校验</title>
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap-table.min.css}">
    <link rel="stylesheet" th:href="@{/bootstrap/css/jquery.treegrid.css}">
    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}"/>
    <link rel="stylesheet" th:href="@{/assets/google-font/google.fonts.css}"/>
    <!--<link rel="stylesheet" th:href="@{/assets/css/ace.min.css}"/>-->
    <!--<link rel="stylesheet" th:href="@{/assets/css/ace-rtl.min.css}"/>-->
    <!--<link rel="stylesheet" th:href="@{/assets/css/ace-skins.min.css}"/>-->
    <link rel="stylesheet" th:href="@{/assets/css/chosen.css}"/>
    <link rel="stylesheet" th:href="@{/assets/css/datepicker.css}"/>
    <link rel="shortcut icon" th:href="@{/img/logo.ico}"/>
    <link rel="stylesheet" th:href="@{/bootstrap/toastr/css/toastr.min.css}"/>


    <style>
        .input-length{
            width: 150px;
        }
    </style>

</head>

<body>
<div class="main-container" style="margin: 10px 0px;">

    <div class="row" style="margin:0px;">
        <div class="col-sm-12">
            <div class="tabbable">
                <ul class="nav nav-tabs" id="myTab">
                    <li class="active">
                        <a data-toggle="tab" href="#home">
                            数据列表
                        </a>
                    </li>

                    <li>
                        <a data-toggle="tab" href="#profile">
                            手动抽取
                        </a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div id="home" class="tab-pane in active">
                        <div id="treegrid_toolbar">
                            <form class="form-inline">
                                <div class="form-group">
                                    <label for="exampleInputName2">数据子集:</label>
                                    <input type="text" class="form-control" id="exampleInputName2" placeholder="Jane Doe">
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputEmail2">搜索条件:</label>
                                    <input type="email" class="form-control" id="exampleInputEmail2" placeholder="jane.doe@example.com">
                                </div>

                                <button type="button" class="btn btn-primary">搜索</button>
                            </form>

                        </div>
                        <!--表格区域  -->
                        <table id="infoTable" class="table-align table-hover"></table>
                    </div>

                    <div id="profile" class="tab-pane">
                        <div id="simple_toolbar">
                            <form class="form-inline">

                                <div class="form-group">
                                    <label for="orgCode">医院代码</label>
                                    <input type="text" class="form-control input-sm input-length" id="orgCode" th:value="${orgCode}"
                                           placeholder="请输入机构代码" style="width: 150px;"/>
                                </div>
                                <div class="form-group">
                                    <label for="orgName">医院名称</label>
                                    <input type="text" class="form-control input-sm input-length" id="orgName" th:value="${orgName}"
                                           placeholder="请输入机构名称" style="width: 150px;"/>
                                </div>
                                <div class="form-group">
                                        <label for="orgName">数据子集</label>
                                        <select class="form-control input-sm input-length" name="data_set" id="data_set" style="width: 200px;">
                                            <option value="0">-----全部-----</option>
                                            <option th:each="list:${dataSet}" th:value="${list.dictValue}"
                                                    th:text="${list.dictLabel }"></option>
                                        </select>
                                </div>
                                <div class="form-group">
                                    <label >开始日期</label>
                                    <div class="input-group input-group-sm">
                                        <input type="text" id="startDate" class="form-control hasDatepicker input-sm input-length" data-date-format="yyyy-mm-dd" style="width: 100px;"/>
                                        <span class="input-group-addon">
                                                            <i class="fa fa-calendar bigger-110"></i>
                                                        </span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label> 结束日期</label>
                                    <div class="input-group input-group-sm">
                                        <input type="text" id="endDate" class="form-control hasDatepicker input-sm input-length" data-date-format="yyyy-mm-dd" style="width: 100px;">
                                        <span class="input-group-addon">
                                                            <i class="fa fa-calendar bigger-110"></i>
                                                        </span>
                                    </div>
                                </div>
                                <button id="handDataLoad" type="button" class="btn btn-primary btn-sm">开始抽取</button>
                            </form>

                        </div>
                        <table id="simple_table"></table>
                    </div>
                </div>
            </div>
        </div><!-- /span -->
    </div>
</div>

</body>
<!--[if !IE]> -->
<script th:src="@{/bootstrap/js/jquery-2.2.4.min.js}"></script>
<!-- <![endif]-->
<!--[if IE]>
<script type="text/javascript" th:src="@{/bootstrap/js/jquery-1.12.4.min.js}"></script>
<![endif]-->
<script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap-table.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap-table-treegrid.min.js}"></script>
<script th:src="@{/bootstrap/js/jquery.treegrid.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap-datepicker.min.js}"></script>
<script th:src="@{/bootstrap/js/bootstrap-datepicker.zh-CN.min.js}"></script>
<script th:src="@{/bootstrap/toastr/js/toastr.min.js}"></script>
<!--ace-->
<script th:src="@{/assets/js/ace-elements.min.js}"></script>
<script th:src="@{/assets/js/ace.min.js}"></script>
<script th:src="@{/assets/js/ace-extra.min.js}"></script>
<script th:src="@{/assets/js/chosen.jquery.min.js}"></script>

<script th:inline="javascript" type="text/javascript">


    var ctx = /*[[@{/}]]*/'';
    // alert(ctx+'modelCheck/modelCheck');
    var $table = $('#treegrid_table');
    var $simple_table = $('#simple_table');
    $(function () {
        toastr.options= {
            "closeButton":false,//显示关闭按钮
            "debug":false,//启用debug
            "positionClass":"toast-top-center",//弹出的位置
            "showDuration":"300",//显示的时间
            "hideDuration":"1000",//消失的时间
            "timeOut":"5000",//停留的时间
            "extendedTimeOut":"1000",//控制时间
            "showEasing":"swing",//显示时的动画缓冲方式
            "hideEasing":"linear",//消失时的动画缓冲方式
            "showMethod":"fadeIn",//显示时的动画方式
            "hideMethod":"fadeOut"//消失时的动画方式
        };



        //机构代码和机构名称
        $("#orgCode").blur(function () {
            let orgCode = $("#orgCode").val();
            let orgName = $("#orgName").val();
            $.ajax({
                url: ctx + "/dataLoad/orgInfo",
                method: "post",
                data: {orgCode: orgCode, orgName: orgName},
                success: function (data) {

                }
            });
        });
        $("#orgName").blur(function () {
            let orgCode = $("#orgCode").val();
            let orgName = $("#orgName").val();
            $.ajax({
                url: ctx + "/dataLoad/orgInfo",
                method: "post",
                data: {orgCode: orgCode, orgName: orgName},
                success: function (data) {

                }
            });
        });
        $('.hasDatepicker').datepicker({
            autoclose:true,
            language:"zh-CN",
            todayHighlight: true
        }).next().on(ace.click_event, function(){
            $(this).prev().focus();
        });

        $table.bootstrapTable({
            url: ctx + 'modelCheck/list',
            height: $(window).height(),
            striped: true,
            toolbar: '#treegrid_toolbar',
            sidePagination: 'client',
            idField: 'id',
            columns: [
                // {
                //     field: 'ck',
                //     checkbox: true
                // },
                {
                    field: 'colummName',
                    width: '40%',
                    title: '模板名称'
                }, {
                    field: 'errorDesc',
                    width: '60%',
                    title: '结果分析'
                }
            ],
            treeShowField: 'colummName',
            parentIdField: 'pid',
            onLoadSuccess: function (data) {
                console.log(data);
                // jquery.treegrid.js
                $table.treegrid({
                    initialState: 'collapsed',
                    treeColumn: 0,
                    // expanderExpandedClass: 'glyphicon glyphicon-minus',
                    // expanderCollapsedClass: 'glyphicon glyphicon-plus',
                    onChange: function () {
                        $table.bootstrapTable('resetWidth');
                    }
                });
            }
        });

        $simple_table.bootstrapTable({
            url: ctx + 'handDataCheckTable/list',
            height: $(window).height(),
            striped: true,
            toolbar: '#simple_toolbar',
            sidePagination: 'client',
            idField: 'id',
            columns: [
                {
                    title: '序号',
                    formatter: function (value, row, index) {
                        return index+1;}

                    },

                {
                    field: 'map.sourceName',
                    width: '40%',
                    title: '数据子集'
                },
                {
                    field: 'realCount',
                    title: '抽取数量',
                    width: '10%',
                    formatter : function (value, row, index) {
                        if (row['dataCount'] != row['realCount'] ) {
                            return '<i style="color: red;font-weight: bold;">'+row['realCount']+'</i>';
                        }
                        return value;
                    },
                    align: 'center',
                },
                {
                    field: 'dataCount',
                    width: '10%',
                    title: '病历总数'
                },
                {
                    field: 'errorDesc',
                    width: '40%',
                    title: '错误分析'
                }
            ],
        });
    });


    //手动抽取数据
    $("#handDataLoad").click(function(){
        var startDate =$("#startDate").val();
        var endDate =$("#endDate").val();
        var orgCode =$("#orgCode").val();
        var orgName =$("#orgName").val();
        var data_set =$("#data_set").val();
        if(orgCode ==null || orgCode ==''){
            toastr.warning("医院代码不能为空");
            return false;
        }
        if(orgName ==null || orgName ==''){
            toastr.warning("医院名称不能为空");
            return false;
        }

        if(startDate ==null || startDate ==''){
            toastr.warning('开始时间不能为空');
            return false;
        }
        if(endDate ==null || endDate ==''){
            toastr.warning("结束时间不能为空");
            return false;
        }
        if(startDate >= endDate ){
            toastr.warning("开始时间不能大于结束时间");
            return false;
        }
        startDate =startDate+" 00:00:00";
        endDate =endDate+" 23:59:59";
        $.ajax({
            type: "POST",
            url:"startLoad",
            data:{startDate:startDate,endDate:endDate,data_set:data_set},
            cache : false,
            dataType:"json",
            async: false,
            error: function(request) {
            },
            success: function(data) {
                if(data.success=='1'){
                    $simple_table.bootstrapTable('refresh');
                }else{
                    toastr.warning("抽取失败");
                }
            }
        });
    });


    // 格式化类型
    function typeFormatter(value, row, index) {
        if (value === 'menu') {
            return '菜单';
        }
        if (value === 'button') {
            return '按钮';
        }
        if (value === 'api') {
            return '接口';
        }
        return '-';
    }


    // 格式化状态
    function statusFormatter(value, row, index) {
        if (value === 0) {
            //0：正确 1：错误
            return '<i class="fa fa-check" style="color: #00B83F"></i>';
        } else if(value === 1) {
            return '<i class="fa fa-times" style="color: red"></i>';
        }else{
            return '';
        }
    }

    function countAndRealCount(){

    }

</script>

</html>